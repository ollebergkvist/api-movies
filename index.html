<p><a href="https://travis-ci.com/ollebergkvist/api-movie"><img alt="Build Status" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MCIgaGVpZ2h0PSIyMCI+PGxpbmVhckdyYWRpZW50IGlkPSJhIiB4Mj0iMCIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI2JiYiIgc3RvcC1vcGFjaXR5PSIuMSIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1vcGFjaXR5PSIuMSIvPjwvbGluZWFyR3JhZGllbnQ+PHJlY3Qgcng9IjMiIHdpZHRoPSI5MCIgaGVpZ2h0PSIyMCIgZmlsbD0iIzU1NSIvPjxyZWN0IHJ4PSIzIiB4PSIzNyIgd2lkdGg9IjUzIiBoZWlnaHQ9IjIwIiBmaWxsPSIjNGMxIi8+PHBhdGggZmlsbD0iIzRjMSIgZD0iTTM3IDBoNHYyMGgtNHoiLz48cmVjdCByeD0iMyIgd2lkdGg9IjkwIiBoZWlnaHQ9IjIwIiBmaWxsPSJ1cmwoI2EpIi8+PGcgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkRlamFWdSBTYW5zLFZlcmRhbmEsR2VuZXZhLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiPjx0ZXh0IHg9IjE5LjUiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5idWlsZDwvdGV4dD48dGV4dCB4PSIxOS41IiB5PSIxNCI+YnVpbGQ8L3RleHQ+PHRleHQgeD0iNjIuNSIgeT0iMTUiIGZpbGw9IiMwMTAxMDEiIGZpbGwtb3BhY2l0eT0iLjMiPnBhc3Npbmc8L3RleHQ+PHRleHQgeD0iNjIuNSIgeT0iMTQiPnBhc3Npbmc8L3RleHQ+PC9nPjwvc3ZnPg=="></a>
<a href="https://scrutinizer-ci.com/g/ollebergkvist/api-movie/?branch=main"><img alt="Scrutinizer Code Quality" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMTMiIGhlaWdodD0iMjAiPjxsaW5lYXJHcmFkaWVudCBpZD0iYiIgeDI9IjAiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNiYmIiIHN0b3Atb3BhY2l0eT0iLjEiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3Atb3BhY2l0eT0iLjEiLz48L2xpbmVhckdyYWRpZW50PjxtYXNrIGlkPSJhIj48cmVjdCB3aWR0aD0iMTEzIiBoZWlnaHQ9IjIwIiByeD0iMyIgZmlsbD0iI2ZmZiIvPjwvbWFzaz48ZyBtYXNrPSJ1cmwoI2EpIj48cGF0aCBmaWxsPSIjNTU1IiBkPSJNMCAwaDcxdjIwSDB6Ii8+PHBhdGggZmlsbD0iIzRjMSIgZD0iTTcxIDBoNDJ2MjBINzF6Ii8+PHBhdGggZmlsbD0idXJsKCNiKSIgZD0iTTAgMGgxMTN2MjBIMHoiLz48L2c+PGcgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkRlamFWdSBTYW5zLFZlcmRhbmEsR2VuZXZhLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiPjx0ZXh0IHg9IjM2LjUiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5TY3J1dGluaXplcjwvdGV4dD48dGV4dCB4PSIzNi41IiB5PSIxNCI+U2NydXRpbml6ZXI8L3RleHQ+PHRleHQgeD0iOTEiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj4xMC4wMDwvdGV4dD48dGV4dCB4PSI5MSIgeT0iMTQiPjEwLjAwPC90ZXh0PjwvZz48L3N2Zz4="></a>
<a href="https://scrutinizer-ci.com/g/ollebergkvist/api-movie/?branch=main"><img alt="Code Coverage" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDMiIGhlaWdodD0iMjAiPjxsaW5lYXJHcmFkaWVudCBpZD0iYiIgeDI9IjAiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNiYmIiIHN0b3Atb3BhY2l0eT0iLjEiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3Atb3BhY2l0eT0iLjEiLz48L2xpbmVhckdyYWRpZW50PjxtYXNrIGlkPSJhIj48cmVjdCB3aWR0aD0iMTAzIiBoZWlnaHQ9IjIwIiByeD0iMyIgZmlsbD0iI2ZmZiIvPjwvbWFzaz48ZyBtYXNrPSJ1cmwoI2EpIj48cGF0aCBmaWxsPSIjNTU1IiBkPSJNMCAwaDYzdjIwSDB6Ii8+PHBhdGggZmlsbD0iI2UwNWQ0NCIgZD0iTTYzIDBoNDB2MjBINjN6Ii8+PHBhdGggZmlsbD0idXJsKCNiKSIgZD0iTTAgMGgxMDN2MjBIMHoiLz48L2c+PGcgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkRlamFWdSBTYW5zLFZlcmRhbmEsR2VuZXZhLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiPjx0ZXh0IHg9IjMyLjUiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5jb3ZlcmFnZTwvdGV4dD48dGV4dCB4PSIzMi41IiB5PSIxNCI+Y292ZXJhZ2U8L3RleHQ+PHRleHQgeD0iODIiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj40OSAlPC90ZXh0Pjx0ZXh0IHg9IjgyIiB5PSIxNCI+NDkgJTwvdGV4dD48L2c+PC9zdmc+"></a>
<a href="https://scrutinizer-ci.com/g/ollebergkvist/api-movie/build-status/main"><img alt="Build Status" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NyIgaGVpZ2h0PSIyMCI+PGxpbmVhckdyYWRpZW50IGlkPSJiIiB4Mj0iMCIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI2JiYiIgc3RvcC1vcGFjaXR5PSIuMSIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1vcGFjaXR5PSIuMSIvPjwvbGluZWFyR3JhZGllbnQ+PG1hc2sgaWQ9ImEiPjxyZWN0IHdpZHRoPSI4NyIgaGVpZ2h0PSIyMCIgcng9IjMiIGZpbGw9IiNmZmYiLz48L21hc2s+PGcgbWFzaz0idXJsKCNhKSI+PHBhdGggZmlsbD0iIzU1NSIgZD0iTTAgMGgzN3YyMEgweiIvPjxwYXRoIGZpbGw9IiM0YzEiIGQ9Ik0zNyAwaDUwdjIwSDM3eiIvPjxwYXRoIGZpbGw9InVybCgjYikiIGQ9Ik0wIDBoODd2MjBIMHoiLz48L2c+PGcgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkRlamFWdSBTYW5zLFZlcmRhbmEsR2VuZXZhLHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiPjx0ZXh0IHg9IjE5LjUiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5idWlsZDwvdGV4dD48dGV4dCB4PSIxOS41IiB5PSIxNCI+YnVpbGQ8L3RleHQ+PHRleHQgeD0iNjEiIHk9IjE1IiBmaWxsPSIjMDEwMTAxIiBmaWxsLW9wYWNpdHk9Ii4zIj5wYXNzZWQ8L3RleHQ+PHRleHQgeD0iNjEiIHk9IjE0Ij5wYXNzZWQ8L3RleHQ+PC9nPjwvc3ZnPg=="></a></p>
<h1>Install</h1>
<pre class="code-block"><code class="language-">Clone repo: git clone https://github.com/ollebergkvist/api-movie

Install dependencies: npm install

Create .env file: touch .env

Create folders: mkdir uploads logs

Start development: npm run dev

Start production: npm run start
</code></pre>
<h1>Environment variables</h1>
<pre class="code-block"><code class="language-">Set the required env variables in the .env file

SECRET={jwtSecret}
MONGDODB_URI={URI}
PORT={PORT}
</code></pre>
<h1>Database</h1>
<pre class="code-block"><code class="language-">Path to db dump:
/db/dump

Backup
mongodump --db movies --archive=movies.archive --gzip

Restore
mongorestore --gzip --archive=movies.archive
</code></pre>
<h1>Precreated users</h1>
<pre class="code-block"><code class="language-">User
username: user@user.com
password: Password#1

Admin
username: admin@admin.com
password: Password#1
</code></pre>
<h1>Postman collection</h1>
<pre class="code-block"><code class="language-">Development (localhost):
https://www.getpostman.com/collections/7a71e416d915d809cea9

Deployed (heroku):
https://www.getpostman.com/collections/76d500b0ba866b15bbb4
</code></pre>
<h1>Docker</h1>
<pre class="code-block"><code class="language-">docker build -t {tagname} .
docker run -d -p {port}:{port} {tagname}
docker-compose up --detach

</code></pre>
<h1>Movie API documentation</h1>
<pre class="code-block"><code class="language-">Routes open to the public:
GET /movies
GET /movies/:id
GET /search
</code></pre>
<pre class="code-block"><code class="language-">Routes secured by JWT:
POST /movies/rent
POST /movies/purchase
PUT /favorite

The mentioned routes need a valid JSON Web Token (JWT) set in the HTTP-header.
The 'x-access-token' header should contain the JWT. In order to retrieve a token, a user
need to register and login successfully via the routes stated below:
POST /register
POST /login
</code></pre>
<pre class="code-block"><code class="language-">Routes secured with JWT plus admin rights:
GET /admin/movies
GET /admin/movies/:id
GET /admin/search
POST /movies
PUT /movies/:id
DELETE /movies/:id
POST /remove/:id
PUT /availability/:id
PUT /return/:id
GET /users
PUT /users/:id

</code></pre>
<h2 id="movies">Movies</h2>
<h3 id="a-movie-has-the-following-attributes%3A">A movie has the following attributes:</h3>
<pre class="code-block"><code class="language-">id
title
description
image
stock
deleted
rental_price
sales_price
availability
likes
createdAt
updatedAt
</code></pre>
<h1>Get all movies:</h1>
<h3 id="resource-url">Resource URL</h3>
<pre class="code-block"><code class="language-">GET /api/movies
</code></pre>
<h3 id="description">Description</h3>
<pre class="code-block"><code class="language-">Regular users can only fetch movies marked as available in the collection.
Pagination, sorting (all collection fields) and limiting is supported by default.

Use - prefixes to sort in descending order and no prefixes to sort in ascending order.
</code></pre>
<h3 id="example">Example</h3>
<pre class="code-block"><code class="language-">Example URL:
http://localhost:3000/api/movies?sort=title&amp;limit=3&amp;page=1
</code></pre>
<h3 id="result%3A">Result:</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/movies&quot;,
    &quot;detail&quot;: &quot;Movies fetched&quot;,
    &quot;document&quot;: {
        &quot;docs&quot;: [
            {
                &quot;stock&quot;: 5,
                &quot;rental_price&quot;: 10,
                &quot;sales_price&quot;: 20,
                &quot;availability&quot;: true,
                &quot;likes&quot;: 1,
                &quot;deleted&quot;: false,
                &quot;_id&quot;: &quot;604935b38b6af1337936a9ad&quot;,
                &quot;title&quot;: &quot;Fight Club &quot;,
                &quot;description&quot;: &quot;An insomniac office worker and a devil-may-care soapmaker form an underground fight club that evolves into something much, much more.&quot;,
                &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMmEzNTkxYjQtZTc0MC00YTVjLTg5ZTEtZWMwOWVlYzY0NWIwXkEyXkFqcGdeQXVyNzkwMjQ5NzM@._V1_UX182_CR0,0,182,268_AL_.jpg&quot;,
                &quot;__v&quot;: 0,
                &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;,
                &quot;updatedAt&quot;: &quot;2021-03-11T00:24:59.146Z&quot;
            },
            {
                &quot;stock&quot;: 5,
                &quot;rental_price&quot;: 10,
                &quot;sales_price&quot;: 20,
                &quot;availability&quot;: true,
                &quot;likes&quot;: 0,
                &quot;deleted&quot;: false,
                &quot;_id&quot;: &quot;604935b38b6af1337936a9ae&quot;,
                &quot;title&quot;: &quot;Forrest Gump&quot;,
                &quot;description&quot;: &quot;The presidencies of Kennedy and Johnson, the Vietnam War, the Watergate scandal and other historical events unfold from the perspective of an Alabama man with an IQ of 75, whose only desire is to be reunited with his childhood sweetheart.&quot;,
                &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BNWIwODRlZTUtY2U3ZS00Yzg1LWJhNzYtMmZiYmEyNmU1NjMzXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_UY268_CR1,0,182,268_AL_.jpg&quot;,
                &quot;__v&quot;: 0,
                &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;,
                &quot;updatedAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;
            },
            {
                &quot;stock&quot;: 5,
                &quot;rental_price&quot;: 10,
                &quot;sales_price&quot;: 20,
                &quot;availability&quot;: true,
                &quot;likes&quot;: 0,
                &quot;deleted&quot;: false,
                &quot;_id&quot;: &quot;604935b38b6af1337936a9af&quot;,
                &quot;title&quot;: &quot;Inception&quot;,
                &quot;description&quot;: &quot;A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.&quot;,
                &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMjAxMzY3NjcxNF5BMl5BanBnXkFtZTcwNTI5OTM0Mw@@._V1_UX182_CR0,0,182,268_AL_.jpg&quot;,
                &quot;__v&quot;: 0,
                &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;,
                &quot;updatedAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;
            }
        ],
        &quot;totalDocs&quot;: 12,
        &quot;limit&quot;: 3,
        &quot;totalPages&quot;: 4,
        &quot;page&quot;: 1,
        &quot;pagingCounter&quot;: 1,
        &quot;hasPrevPage&quot;: false,
        &quot;hasNextPage&quot;: true,
        &quot;prevPage&quot;: null,
        &quot;nextPage&quot;: 2
    }
}

</code></pre>
<h1>Get all movies (admin):</h1>
<h3 id="resource-url-1">Resource URL</h3>
<pre class="code-block"><code class="language-">GET /api/admin/movies
</code></pre>
<h3 id="description-1">Description</h3>
<pre class="code-block"><code class="language-">Admin can only fetch all movies in the collection.
Meaningg movies where the availability is marked as false or true.
Filtering (all collection fields), pagination, sorting (all collection fields) and limiting is supported by default.

Use - prefixes to sort in descending order and no prefixes to sort in ascending order.
</code></pre>
<h3 id="example-1">Example</h3>
<pre class="code-block"><code class="language-">Example URL:
http://localhost:3000/api/admin/movies?availability=false&amp;sort=-title&amp;limit=2
</code></pre>
<h3 id="result%3A-1">Result:</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/admin/movies&quot;,
    &quot;detail&quot;: &quot;Movies fetched&quot;,
    &quot;document&quot;: {
        &quot;docs&quot;: [
            {
                &quot;stock&quot;: 0,
                &quot;rental_price&quot;: 10,
                &quot;sales_price&quot;: 20,
                &quot;availability&quot;: false,
                &quot;likes&quot;: 1,
                &quot;deleted&quot;: false,
                &quot;_id&quot;: &quot;604935b38b6af1337936a9a5&quot;,
                &quot;title&quot;: &quot;The Godfather: Part II&quot;,
                &quot;description&quot;: &quot;The early life and career of Vito Corleone in 1920s New York City is portrayed, while his son, Michael, expands and tightens his grip on the family crime syndicate.&quot;,
                &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMWMwMGQzZTItY2JlNC00OWZiLWIyMDctNDk2ZDQ2YjRjMWQ0XkEyXkFqcGdeQXVyNzkwMjQ5NzM@._V1_UY268_CR3,0,182,268_AL_.jpg&quot;,
                &quot;__v&quot;: 0,
                &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.181Z&quot;,
                &quot;updatedAt&quot;: &quot;2021-03-12T00:38:32.344Z&quot;
            },
            {
                &quot;stock&quot;: 3,
                &quot;rental_price&quot;: 5,
                &quot;sales_price&quot;: 10,
                &quot;availability&quot;: false,
                &quot;likes&quot;: 0,
                &quot;deleted&quot;: false,
                &quot;_id&quot;: &quot;604aa9a7ab706913f38bb032&quot;,
                &quot;title&quot;: &quot;Tenet8&quot;,
                &quot;description&quot;: &quot;A secret agent is given a single word as his weapon and sent to prevent the onset of World War III. He must travel through time and bend the laws of nature in order to be successful in his mission.&quot;,
                &quot;image&quot;: &quot;uploads/bc59560594d5305d2085a7d4c8b220a6.jpg&quot;,
                &quot;createdAt&quot;: &quot;2021-03-11T23:37:11.718Z&quot;,
                &quot;updatedAt&quot;: &quot;2021-03-11T23:37:11.718Z&quot;,
                &quot;__v&quot;: 0
            }
        ],
        &quot;totalDocs&quot;: 4,
        &quot;offset&quot;: 0,
        &quot;limit&quot;: 2,
        &quot;totalPages&quot;: 2,
        &quot;page&quot;: 1,
        &quot;pagingCounter&quot;: 1,
        &quot;hasPrevPage&quot;: false,
        &quot;hasNextPage&quot;: true,
        &quot;prevPage&quot;: null,
        &quot;nextPage&quot;: 2
    }
}

</code></pre>
<h1>Get specific movie:</h1>
<h3 id="resource-url-2">Resource URL</h3>
<pre class="code-block"><code class="language-">GET /api/movies/:id
</code></pre>
<h3 id="description-2">Description</h3>
<pre class="code-block"><code class="language-">Regular users can only fetch movies marked as available in the collection.
</code></pre>
<h3 id="example-2">Example</h3>
<pre class="code-block"><code class="language-">Example URL:
http://localhost:3000/api/movies/604935b38b6af1337936a9af
</code></pre>
<h3 id="result">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/movies/604935b38b6af1337936a9af&quot;,
    &quot;detail&quot;: &quot;Movie fetched&quot;,
    &quot;document&quot;: {
        &quot;stock&quot;: 5,
        &quot;rental_price&quot;: 10,
        &quot;sales_price&quot;: 20,
        &quot;availability&quot;: true,
        &quot;likes&quot;: 0,
        &quot;deleted&quot;: false,
        &quot;_id&quot;: &quot;604935b38b6af1337936a9af&quot;,
        &quot;title&quot;: &quot;Inception&quot;,
        &quot;description&quot;: &quot;A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.&quot;,
        &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMjAxMzY3NjcxNF5BMl5BanBnXkFtZTcwNTI5OTM0Mw@@._V1_UX182_CR0,0,182,268_AL_.jpg&quot;,
        &quot;__v&quot;: 0,
        &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;
    }
}
</code></pre>
<h1>Get specific movie (admin):</h1>
<h3 id="resource-url-3">Resource URL</h3>
<pre class="code-block"><code class="language-">GET /api/admin/movies/:id
</code></pre>
<h3 id="description-3">Description</h3>
<pre class="code-block"><code class="language-">Admin users can fetch all movies marked as available in the collection.
</code></pre>
<h3 id="example-3">Example</h3>
<pre class="code-block"><code class="language-">Example URL:
http://localhost:3000/api/admin/movies/604935b38b6af1337936a9af
</code></pre>
<h3 id="result-1">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/admin/movies/604935b38b6af1337936a9a3&quot;,
    &quot;detail&quot;: &quot;Movie fetched&quot;,
    &quot;document&quot;: {
        &quot;stock&quot;: 22,
        &quot;rental_price&quot;: 22,
        &quot;sales_price&quot;: 100,
        &quot;availability&quot;: false,
        &quot;likes&quot;: 7,
        &quot;deleted&quot;: false,
        &quot;_id&quot;: &quot;604935b38b6af1337936a9a3&quot;,
        &quot;title&quot;: &quot;Shawshank Redemption&quot;,
        &quot;description&quot;: &quot;Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.&quot;,
        &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMDFkYTc0MGEtZmNhMC00ZDIzLWFmNTEtODM1ZmRlYWMwMWFmXkEyXkFqcGdeQXVyMTMxODk2OTU@._V1_UX182_CR0,0,182,268_AL_.jpg&quot;,
        &quot;__v&quot;: 0,
        &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.179Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-03-12T03:09:11.869Z&quot;
    }
}
</code></pre>
<h1>Search movies:</h1>
<pre class="code-block"><code class="language-">POST /api/movies/search/title?
</code></pre>
<h3 id="description-4">Description</h3>
<pre class="code-block"><code class="language-">Regular users can only search for movies marked as available in the collection.
</code></pre>
<h3 id="example-4">Example</h3>
<pre class="code-block"><code class="language-">Example URL:
http://localhost:3000/api/search?title=inception
</code></pre>
<h3 id="example-response">Example response</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/search&quot;,
    &quot;detail&quot;: &quot;Movie fetched&quot;,
    &quot;document&quot;: [
        {
            &quot;stock&quot;: 5,
            &quot;rental_price&quot;: 10,
            &quot;sales_price&quot;: 20,
            &quot;availability&quot;: true,
            &quot;likes&quot;: 0,
            &quot;deleted&quot;: false,
            &quot;_id&quot;: &quot;604935b38b6af1337936a9af&quot;,
            &quot;title&quot;: &quot;Inception&quot;,
            &quot;description&quot;: &quot;A thief who steals corporate secrets through the use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O.&quot;,
            &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMjAxMzY3NjcxNF5BMl5BanBnXkFtZTcwNTI5OTM0Mw@@._V1_UX182_CR0,0,182,268_AL_.jpg&quot;,
            &quot;__v&quot;: 0,
            &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;,
            &quot;updatedAt&quot;: &quot;2021-03-10T21:10:11.183Z&quot;
        }
    ]
}
</code></pre>
<h1>Search movies (admin):</h1>
<pre class="code-block"><code class="language-">POST /api/admin/movies/search/title?
</code></pre>
<h3 id="description-5">Description</h3>
<pre class="code-block"><code class="language-">Admin can search for all movies in the collection.
</code></pre>
<h3 id="example-5">Example</h3>
<pre class="code-block"><code class="language-">Example URL:
http://localhost:3000/api/admin/search?title=shawshank redemption
</code></pre>
<h3 id="example-response-1">Example response</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/admin/search&quot;,
    &quot;detail&quot;: &quot;Movie fetched&quot;,
    &quot;document&quot;: [
        {
            &quot;stock&quot;: 22,
            &quot;rental_price&quot;: 22,
            &quot;sales_price&quot;: 100,
            &quot;availability&quot;: false,
            &quot;likes&quot;: 7,
            &quot;deleted&quot;: false,
            &quot;_id&quot;: &quot;604935b38b6af1337936a9a3&quot;,
            &quot;title&quot;: &quot;Shawshank Redemption&quot;,
            &quot;description&quot;: &quot;Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.&quot;,
            &quot;image&quot;: &quot;https://m.media-amazon.com/images/M/MV5BMDFkYTc0MGEtZmNhMC00ZDIzLWFmNTEtODM1ZmRlYWMwMWFmXkEyXkFqcGdeQXVyMTMxODk2OTU@._V1_UX182_CR0,0,182,268_AL_.jpg&quot;,
            &quot;__v&quot;: 0,
            &quot;createdAt&quot;: &quot;2021-03-10T21:10:11.179Z&quot;,
            &quot;updatedAt&quot;: &quot;2021-03-12T03:09:11.869Z&quot;
        }
    ]
}
</code></pre>
<h1>Add movie (admin)</h1>
<pre class="code-block"><code class="language-">POST /api/movies
</code></pre>
<h3 id="description-6">Description</h3>
<pre class="code-block"><code class="language-">Supports upload functionality of images, if form-data is used over body.
Images are stored in the uploads folder.
</code></pre>
<h3 id="required-parameters%3A">Required parameters:</h3>
<pre class="code-block"><code class="language-">title
description
image
</code></pre>
<h3 id="optional-parameters-(if-not-set-default-values-are-used)%3A">Optional parameters (if not set default values are used):</h3>
<pre class="code-block"><code class="language-">stock
rental_price
sales_price
availability
likes
</code></pre>
<h3 id="result-2">Result</h3>
<pre class="code-block"><code class="language-">HTTP Status Code 201 Created
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/movies&quot;,
    &quot;title&quot;: &quot;Movie exists already&quot;
}
</code></pre>
<h1>Delete movie (admin)</h1>
<pre class="code-block"><code class="language-">DELETE /api/movies/:id
</code></pre>
<h3 id="description-7">Description</h3>
<pre class="code-block"><code class="language-">Deletes item from collection.
Hard delete.
</code></pre>
<h3 id="response">Response</h3>
<pre class="code-block"><code class="language-">HTTP Status Code 204 No Content
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-1">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/movies/:id&quot;,
    &quot;title&quot;: &quot;Movie with given id could not be found&quot;
}
</code></pre>
<h1>Remove movie (admin)</h1>
<pre class="code-block"><code class="language-">PUT /api/movies/:id
</code></pre>
<h3 id="description-8">Description</h3>
<pre class="code-block"><code class="language-">Marks item as deleted.
Updates field: deleted as true.
Soft delete.
</code></pre>
<h3 id="response-1">Response</h3>
<pre class="code-block"><code class="language-">HTTP Status Code 204 No Content
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-2">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/movies/:id&quot;,
    &quot;title&quot;: &quot;Movie with given id could not be found&quot;
}
</code></pre>
<h1>Update movie (admin)</h1>
<pre class="code-block"><code class="language-">PUT /api/movies/:id
</code></pre>
<h3 id="required-parameters-(one-of-the-following)%3A">Required parameters (one of the following):</h3>
<pre class="code-block"><code class="language-">title
description
image
stock
rental_price
sales_price
availability
likes

</code></pre>
<h3 id="result-3">Result</h3>
<pre class="code-block"><code class="language-">HTTP Status Code 204 No Content
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-3">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/movies/:id&quot;,
    &quot;title&quot;: &quot;Movie with given id could not be found&quot;
}
</code></pre>
<h1>Change availability of a movie (admin)</h1>
<pre class="code-block"><code class="language-">PUT /api/availability/:id
</code></pre>
<h3 id="result-4">Result</h3>
<pre class="code-block"><code class="language-">HTTP Status Code 204 No Content
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-4">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/availability/604935b38b6af1337936a9a2&quot;,
    &quot;title&quot;: &quot;Movie with given id could not be found&quot;
}
</code></pre>
<h1>Rentals</h1>
<h3 id="a-rental-has-the-following-attributes%3A">A rental has the following attributes:</h3>
<pre class="code-block"><code class="language-">movie_id
customer_id
amount
cost
return_date
returned
rental_price
penalty
returnedAt
createdAt
updatedAt
</code></pre>
<h1>Add rental</h1>
<pre class="code-block"><code class="language-">POST /api/movies
</code></pre>
<h3 id="required-parameters%3A-1">Required parameters:</h3>
<pre class="code-block"><code class="language-">movie_id
customer_id
amount
cost

</code></pre>
<h3 id="optional-parameters%3A">Optional parameters:</h3>
<pre class="code-block"><code class="language-">return_date
returned
penalty
</code></pre>
<h3 id="result-5">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;201&quot;,
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/movies/rent&quot;,
    &quot;message&quot;: &quot;Movie successfully rented&quot;,
    &quot;document&quot;: {
        &quot;returnDate&quot;: &quot;2021-03-15T14:30:22.499Z&quot;,
        &quot;returned&quot;: false,
        &quot;_id&quot;: &quot;604b7f83224fc02506fb5d9a&quot;,
        &quot;movieID&quot;: &quot;604935b38b6af1337936a9a9&quot;,
        &quot;customerID&quot;: &quot;604961a685abaa3ee96a4ec5&quot;,
        &quot;amount&quot;: 2,
        &quot;cost&quot;: 33,
        &quot;createdAt&quot;: &quot;2021-03-12T14:49:39.782Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-03-12T14:49:39.782Z&quot;,
        &quot;__v&quot;: 0
    }
}
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-5">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: 400,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/movies/purchase&quot;,
    &quot;message&quot;: &quot;Insufficient stock to complete order&quot;
}
</code></pre>
<h1>Purchases</h1>
<h3 id="a-purchase-has-the-following-attributes%3A">A purchase has the following attributes:</h3>
<pre class="code-block"><code class="language-">movie_id
customer_id
amount
cost
createdAt
updatedAt
</code></pre>
<h1>Add purchase</h1>
<pre class="code-block"><code class="language-">POST /api/movies/purchase
</code></pre>
<h3 id="required-parameters%3A-2">Required parameters:</h3>
<pre class="code-block"><code class="language-">movie_id
customer_id
amount
cost
</code></pre>
<h3 id="result-6">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;201&quot;,
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/movies/purchase&quot;,
    &quot;message&quot;: &quot;Movie successfully purchased&quot;,
    &quot;document&quot;: {
        &quot;_id&quot;: &quot;604b7dda224fc02506fb5d83&quot;,
        &quot;movieID&quot;: &quot;604935b38b6af1337936a9a9&quot;,
        &quot;customerID&quot;: &quot;604961a685abaa3ee96a4ec5&quot;,
        &quot;amount&quot;: 1,
        &quot;cost&quot;: 1,
        &quot;createdAt&quot;: &quot;2021-03-12T14:42:34.320Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-03-12T14:42:34.320Z&quot;,
        &quot;__v&quot;: 0
    }
}
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-6">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: 400,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/movies/purchase&quot;,
    &quot;message&quot;: &quot;Insufficient stock to complete order&quot;
}
</code></pre>
<h1>Return movie (admin):</h1>
<pre class="code-block"><code class="language-">PUT /api/admin/movies/return/:id
</code></pre>
<h3 id="example-response-2">Example response</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;204&quot;,
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/return/604b913add61ac25900135b8&quot;,
    &quot;message&quot;: &quot;Movie successfully returned&quot;
}
</code></pre>
<h1>Register</h1>
<h3 id="resource-url-4">Resource URL</h3>
<pre class="code-block"><code class="language-">POST /api/register
</code></pre>
<h3 id="required-parameters%3A-3">Required parameters:</h3>
<pre class="code-block"><code class="language-">email
password
</code></pre>
<h3 id="result%3A-2">Result:</h3>
<pre class="code-block"><code class="language-">{   &quot;status&quot;: 201,
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/register&quot;,
    &quot;detail&quot;: &quot;Registration succeeded&quot;
}
</code></pre>
<h1>Login</h1>
<h3 id="resource-url-5">Resource URL</h3>
<pre class="code-block"><code class="language-">POST /api/login
</code></pre>
<h3 id="required-parameters%3A-4">Required parameters:</h3>
<pre class="code-block"><code class="language-">email
password
</code></pre>
<h3 id="result%3A-3">Result:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;200&quot;
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/login&quot;,
    &quot;detail&quot;: &quot;User logged in&quot;,
    &quot;user&quot;: &quot;admin@admin.com&quot;,
    &quot;admin&quot;: true,
    &quot;token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFkbWluQGFkbWluLmNvbSIsImFkbWluIjp0cnVlLCJpYXQiOjE2MTU1NjAwNTEsImV4cCI6MTYxNTY0NjQ1MX0.y3f7c5kRUbMTLEr-wgYfRDHh1lciPn-ju_Rt61zRKdM&quot;
}
</code></pre>
<p>N.B. The access token expires after 24 hours.</p>
<h1>Get all users (admin):</h1>
<pre class="code-block"><code class="language-">GET /api/admin/movies/return/:id
</code></pre>
<h3 id="example-response-3">Example response</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;message&quot;: &quot;Users retrieved successfully&quot;,
    &quot;documents&quot;: [
        {
            &quot;admin&quot;: true,
            &quot;_id&quot;: &quot;604961a685abaa3ee96a4ec4&quot;,
            &quot;email&quot;: &quot;admin@admin.com&quot;,
            &quot;password&quot;: &quot;$2a$10$jJnGhCVxf/VMUcmCdc387uhI8e1Q8dq2Ko76huSsnqAbx9mLrIuHG&quot;,
            &quot;favorites&quot;: [],
            &quot;createdAt&quot;: &quot;2021-03-11T00:17:42.809Z&quot;,
            &quot;updatedAt&quot;: &quot;2021-03-11T00:17:42.809Z&quot;,
            &quot;__v&quot;: 0
        },
        {
            &quot;admin&quot;: false,
            &quot;_id&quot;: &quot;604961a685abaa3ee96a4ec5&quot;,
            &quot;email&quot;: &quot;user@user.com&quot;,
            &quot;password&quot;: &quot;$2a$10$jJnGhCVxf/VMUcmCdc387uhI8e1Q8dq2Ko76huSsnqAbx9mLrIuHG&quot;,
            &quot;favorites&quot;: [],
            &quot;createdAt&quot;: &quot;2021-03-11T00:17:42.841Z&quot;,
            &quot;updatedAt&quot;: &quot;2021-03-11T00:25:32.380Z&quot;,
            &quot;__v&quot;: 8
        },
    ]
}
</code></pre>
<h1>Get specific movie (admin):</h1>
<h3 id="resource-url-6">Resource URL</h3>
<pre class="code-block"><code class="language-">GET /api/users/:id
</code></pre>
<h3 id="result-7">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/users/604961a685abaa3ee96a4ec4&quot;,
    &quot;detail&quot;: &quot;User found&quot;,
    &quot;document&quot;: {
        &quot;admin&quot;: true,
        &quot;_id&quot;: &quot;604961a685abaa3ee96a4ec4&quot;,
        &quot;email&quot;: &quot;admin@admin.com&quot;,
        &quot;password&quot;: &quot;$2a$10$jJnGhCVxf/VMUcmCdc387uhI8e1Q8dq2Ko76huSsnqAbx9mLrIuHG&quot;,
        &quot;favorites&quot;: [],
        &quot;createdAt&quot;: &quot;2021-03-11T00:17:42.809Z&quot;,
        &quot;updatedAt&quot;: &quot;2021-03-11T00:17:42.809Z&quot;,
        &quot;__v&quot;: 0
    }
}
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-7">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/users/604961a685abaa3ee96a4ec3&quot;,
    &quot;detail&quot;: &quot;User with given id could not be found&quot;
}
</code></pre>
<h1>Change user permissions (admin):</h1>
<h3 id="resource-url-7">Resource URL</h3>
<pre class="code-block"><code class="language-">PUT /api/users/:id
</code></pre>
<h3 id="required-parameters%3A-5">Required parameters:</h3>
<pre class="code-block"><code class="language-">admin
</code></pre>
<h3 id="result-8">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;204&quot;,
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/users/604961a685abaa3ee96a4ec5&quot;,
    &quot;detail&quot;: &quot;User rights updated successfully&quot;
}
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-8">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;404&quot;
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/users/:id&quot;,
    &quot;detail&quot;: &quot;User with given id could not be found&quot;
}
</code></pre>
<h1>Add movie to favorites:</h1>
<h3 id="resource-url-8">Resource URL</h3>
<pre class="code-block"><code class="language-">PUT /api/favorite
</code></pre>
<h3 id="required-parameters%3A-6">Required parameters:</h3>
<pre class="code-block"><code class="language-">id
movie_id
</code></pre>
<h3 id="result-9">Result</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;200&quot;,
    &quot;type&quot;: &quot;Success&quot;,
    &quot;source&quot;: &quot;/favorite&quot;,
    &quot;detail&quot;: &quot;Movie added to user favorites and number of likes in given movie was incremented with 1&quot;
}
</code></pre>
<h3 id="possible-error%2C-besides-errors-returned-from-db%3A-9">Possible error, besides errors returned from db:</h3>
<pre class="code-block"><code class="language-">{
    &quot;status&quot;: &quot;400&quot;,
    &quot;type&quot;: &quot;Error&quot;,
    &quot;source&quot;: &quot;/favorite&quot;,
    &quot;detail&quot;: &quot;Movie has already been added to user's favorites&quot;
}
</code></pre>

